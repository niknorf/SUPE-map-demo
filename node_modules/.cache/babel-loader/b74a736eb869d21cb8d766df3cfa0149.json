{"ast":null,"code":"/*\n * Copyright 2016 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n(function (window, undefined) {\n  var Keycloak = function (config) {\n    if (!(this instanceof Keycloak)) {\n      return new Keycloak(config);\n    }\n\n    var kc = this;\n    var adapter;\n    var refreshQueue = [];\n    var callbackStorage;\n    var loginIframe = {\n      enable: true,\n      callbackList: [],\n      interval: 5\n    };\n    var scripts = document.getElementsByTagName('script');\n\n    for (var i = 0; i < scripts.length; i++) {\n      if ((scripts[i].src.indexOf('keycloak.js') !== -1 || scripts[i].src.indexOf('keycloak.min.js') !== -1) && scripts[i].src.indexOf('version=') !== -1) {\n        kc.iframeVersion = scripts[i].src.substring(scripts[i].src.indexOf('version=') + 8).split('&')[0];\n      }\n    }\n\n    var useNonce = true;\n\n    kc.init = function (initOptions) {\n      kc.authenticated = false;\n      callbackStorage = createCallbackStorage();\n\n      if (initOptions && initOptions.adapter === 'cordova') {\n        adapter = loadAdapter('cordova');\n      } else if (initOptions && initOptions.adapter === 'default') {\n        adapter = loadAdapter();\n      } else if (initOptions && typeof initOptions.adapter === \"object\") {\n        adapter = initOptions.adapter;\n      } else {\n        if (window.Cordova || window.cordova) {\n          adapter = loadAdapter('cordova');\n        } else {\n          adapter = loadAdapter();\n        }\n      }\n\n      if (initOptions) {\n        if (typeof initOptions.useNonce !== 'undefined') {\n          useNonce = initOptions.useNonce;\n        }\n\n        if (typeof initOptions.checkLoginIframe !== 'undefined') {\n          loginIframe.enable = initOptions.checkLoginIframe;\n        }\n\n        if (initOptions.checkLoginIframeInterval) {\n          loginIframe.interval = initOptions.checkLoginIframeInterval;\n        }\n\n        if (initOptions.onLoad === 'login-required') {\n          kc.loginRequired = true;\n        }\n\n        if (initOptions.responseMode) {\n          if (initOptions.responseMode === 'query' || initOptions.responseMode === 'fragment') {\n            kc.responseMode = initOptions.responseMode;\n          } else {\n            throw 'Invalid value for responseMode';\n          }\n        }\n\n        if (initOptions.flow) {\n          switch (initOptions.flow) {\n            case 'standard':\n              kc.responseType = 'code';\n              break;\n\n            case 'implicit':\n              kc.responseType = 'id_token token';\n              break;\n\n            case 'hybrid':\n              kc.responseType = 'code id_token token';\n              break;\n\n            default:\n              throw 'Invalid value for flow';\n          }\n\n          kc.flow = initOptions.flow;\n        }\n\n        if (initOptions.timeSkew != null) {\n          kc.timeSkew = initOptions.timeSkew;\n        }\n      }\n\n      if (!kc.responseMode) {\n        kc.responseMode = 'fragment';\n      }\n\n      if (!kc.responseType) {\n        kc.responseType = 'code';\n        kc.flow = 'standard';\n      }\n\n      var promise = createPromise();\n      var initPromise = createPromise();\n      initPromise.promise.success(function () {\n        kc.onReady && kc.onReady(kc.authenticated);\n        promise.setSuccess(kc.authenticated);\n      }).error(function (errorData) {\n        promise.setError(errorData);\n      });\n      var configPromise = loadConfig(config);\n\n      function onLoad() {\n        var doLogin = function (prompt) {\n          if (!prompt) {\n            options.prompt = 'none';\n          }\n\n          kc.login(options).success(function () {\n            initPromise.setSuccess();\n          }).error(function () {\n            initPromise.setError();\n          });\n        };\n\n        var options = {};\n\n        switch (initOptions.onLoad) {\n          case 'check-sso':\n            if (loginIframe.enable) {\n              setupCheckLoginIframe().success(function () {\n                checkLoginIframe().success(function () {\n                  doLogin(false);\n                }).error(function () {\n                  initPromise.setSuccess();\n                });\n              });\n            } else {\n              doLogin(false);\n            }\n\n            break;\n\n          case 'login-required':\n            doLogin(true);\n            break;\n\n          default:\n            throw 'Invalid value for onLoad';\n        }\n      }\n\n      function processInit() {\n        var callback = parseCallback(window.location.href);\n\n        if (callback) {\n          window.history.replaceState({}, null, callback.newUrl);\n        }\n\n        if (callback && callback.valid) {\n          return setupCheckLoginIframe().success(function () {\n            processCallback(callback, initPromise);\n          }).error(function (e) {\n            initPromise.setError();\n          });\n        } else if (initOptions) {\n          if (initOptions.token && initOptions.refreshToken) {\n            setToken(initOptions.token, initOptions.refreshToken, initOptions.idToken);\n\n            if (loginIframe.enable) {\n              setupCheckLoginIframe().success(function () {\n                checkLoginIframe().success(function () {\n                  kc.onAuthSuccess && kc.onAuthSuccess();\n                  initPromise.setSuccess();\n                }).error(function () {\n                  setToken(null, null, null);\n                  initPromise.setSuccess();\n                });\n              });\n            } else {\n              kc.updateToken(-1).success(function () {\n                kc.onAuthSuccess && kc.onAuthSuccess();\n                initPromise.setSuccess();\n              }).error(function () {\n                kc.onAuthError && kc.onAuthError();\n\n                if (initOptions.onLoad) {\n                  onLoad();\n                } else {\n                  initPromise.setError();\n                }\n              });\n            }\n          } else if (initOptions.onLoad) {\n            onLoad();\n          } else {\n            initPromise.setSuccess();\n          }\n        } else {\n          initPromise.setSuccess();\n        }\n      }\n\n      configPromise.success(processInit);\n      configPromise.error(function () {\n        promise.setError();\n      });\n      return promise.promise;\n    };\n\n    kc.login = function (options) {\n      return adapter.login(options);\n    };\n\n    kc.createLoginUrl = function (options) {\n      var state = createUUID();\n      var nonce = createUUID();\n      var redirectUri = adapter.redirectUri(options);\n      var callbackState = {\n        state: state,\n        nonce: nonce,\n        redirectUri: encodeURIComponent(redirectUri)\n      };\n\n      if (options && options.prompt) {\n        callbackState.prompt = options.prompt;\n      }\n\n      callbackStorage.add(callbackState);\n      var baseUrl;\n\n      if (options && options.action == 'register') {\n        baseUrl = kc.endpoints.register();\n      } else {\n        baseUrl = kc.endpoints.authorize();\n      }\n\n      var scope = options && options.scope ? \"openid \" + options.scope : \"openid\";\n      var url = baseUrl + '?client_id=' + encodeURIComponent(kc.clientId) + '&redirect_uri=' + encodeURIComponent(redirectUri) + '&state=' + encodeURIComponent(state) + '&response_mode=' + encodeURIComponent(kc.responseMode) + '&response_type=' + encodeURIComponent(kc.responseType) + '&scope=' + encodeURIComponent(scope);\n\n      if (useNonce) {\n        url = url + '&nonce=' + encodeURIComponent(nonce);\n      }\n\n      if (options && options.prompt) {\n        url += '&prompt=' + encodeURIComponent(options.prompt);\n      }\n\n      if (options && options.maxAge) {\n        url += '&max_age=' + encodeURIComponent(options.maxAge);\n      }\n\n      if (options && options.loginHint) {\n        url += '&login_hint=' + encodeURIComponent(options.loginHint);\n      }\n\n      if (options && options.idpHint) {\n        url += '&kc_idp_hint=' + encodeURIComponent(options.idpHint);\n      }\n\n      if (options && options.locale) {\n        url += '&ui_locales=' + encodeURIComponent(options.locale);\n      }\n\n      if (options && options.kcLocale) {\n        url += '&kc_locale=' + encodeURIComponent(options.kcLocale);\n      }\n\n      return url;\n    };\n\n    kc.logout = function (options) {\n      return adapter.logout(options);\n    };\n\n    kc.createLogoutUrl = function (options) {\n      var url = kc.endpoints.logout() + '?redirect_uri=' + encodeURIComponent(adapter.redirectUri(options, false));\n      return url;\n    };\n\n    kc.register = function (options) {\n      return adapter.register(options);\n    };\n\n    kc.createRegisterUrl = function (options) {\n      if (!options) {\n        options = {};\n      }\n\n      options.action = 'register';\n      return kc.createLoginUrl(options);\n    };\n\n    kc.createAccountUrl = function (options) {\n      var realm = getRealmUrl();\n      var url = undefined;\n\n      if (typeof realm !== 'undefined') {\n        url = realm + '/account' + '?referrer=' + encodeURIComponent(kc.clientId) + '&referrer_uri=' + encodeURIComponent(adapter.redirectUri(options));\n      }\n\n      return url;\n    };\n\n    kc.accountManagement = function () {\n      return adapter.accountManagement();\n    };\n\n    kc.hasRealmRole = function (role) {\n      var access = kc.realmAccess;\n      return !!access && access.roles.indexOf(role) >= 0;\n    };\n\n    kc.hasResourceRole = function (role, resource) {\n      if (!kc.resourceAccess) {\n        return false;\n      }\n\n      var access = kc.resourceAccess[resource || kc.clientId];\n      return !!access && access.roles.indexOf(role) >= 0;\n    };\n\n    kc.loadUserProfile = function () {\n      var url = getRealmUrl() + '/account';\n      var req = new XMLHttpRequest();\n      req.open('GET', url, true);\n      req.setRequestHeader('Accept', 'application/json');\n      req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n      var promise = createPromise();\n\n      req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n          if (req.status == 200) {\n            kc.profile = JSON.parse(req.responseText);\n            promise.setSuccess(kc.profile);\n          } else {\n            promise.setError();\n          }\n        }\n      };\n\n      req.send();\n      return promise.promise;\n    };\n\n    kc.loadUserInfo = function () {\n      var url = kc.endpoints.userinfo();\n      var req = new XMLHttpRequest();\n      req.open('GET', url, true);\n      req.setRequestHeader('Accept', 'application/json');\n      req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n      var promise = createPromise();\n\n      req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n          if (req.status == 200) {\n            kc.userInfo = JSON.parse(req.responseText);\n            promise.setSuccess(kc.userInfo);\n          } else {\n            promise.setError();\n          }\n        }\n      };\n\n      req.send();\n      return promise.promise;\n    };\n\n    kc.isTokenExpired = function (minValidity) {\n      if (!kc.tokenParsed || !kc.refreshToken && kc.flow != 'implicit') {\n        throw 'Not authenticated';\n      }\n\n      if (kc.timeSkew == null) {\n        console.info('[KEYCLOAK] Unable to determine if token is expired as timeskew is not set');\n        return true;\n      }\n\n      var expiresIn = kc.tokenParsed['exp'] - Math.ceil(new Date().getTime() / 1000) + kc.timeSkew;\n\n      if (minValidity) {\n        expiresIn -= minValidity;\n      }\n\n      return expiresIn < 0;\n    };\n\n    kc.updateToken = function (minValidity) {\n      var promise = createPromise();\n\n      if (!kc.refreshToken) {\n        promise.setError();\n        return promise.promise;\n      }\n\n      minValidity = minValidity || 5;\n\n      var exec = function () {\n        var refreshToken = false;\n\n        if (minValidity == -1) {\n          refreshToken = true;\n          console.info('[KEYCLOAK] Refreshing token: forced refresh');\n        } else if (!kc.tokenParsed || kc.isTokenExpired(minValidity)) {\n          refreshToken = true;\n          console.info('[KEYCLOAK] Refreshing token: token expired');\n        }\n\n        if (!refreshToken) {\n          promise.setSuccess(false);\n        } else {\n          var params = 'grant_type=refresh_token&' + 'refresh_token=' + kc.refreshToken;\n          var url = kc.endpoints.token();\n          refreshQueue.push(promise);\n\n          if (refreshQueue.length == 1) {\n            var req = new XMLHttpRequest();\n            req.open('POST', url, true);\n            req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n            req.withCredentials = true;\n\n            if (kc.clientId && kc.clientSecret) {\n              req.setRequestHeader('Authorization', 'Basic ' + btoa(kc.clientId + ':' + kc.clientSecret));\n            } else {\n              params += '&client_id=' + encodeURIComponent(kc.clientId);\n            }\n\n            var timeLocal = new Date().getTime();\n\n            req.onreadystatechange = function () {\n              if (req.readyState == 4) {\n                if (req.status == 200) {\n                  console.info('[KEYCLOAK] Token refreshed');\n                  timeLocal = (timeLocal + new Date().getTime()) / 2;\n                  var tokenResponse = JSON.parse(req.responseText);\n                  setToken(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], timeLocal);\n                  kc.onAuthRefreshSuccess && kc.onAuthRefreshSuccess();\n\n                  for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                    p.setSuccess(true);\n                  }\n                } else {\n                  console.warn('[KEYCLOAK] Failed to refresh token');\n\n                  if (req.status == 400) {\n                    kc.clearToken();\n                  }\n\n                  kc.onAuthRefreshError && kc.onAuthRefreshError();\n\n                  for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                    p.setError(true);\n                  }\n                }\n              }\n            };\n\n            req.send(params);\n          }\n        }\n      };\n\n      if (loginIframe.enable) {\n        var iframePromise = checkLoginIframe();\n        iframePromise.success(function () {\n          exec();\n        }).error(function () {\n          promise.setError();\n        });\n      } else {\n        exec();\n      }\n\n      return promise.promise;\n    };\n\n    kc.clearToken = function () {\n      if (kc.token) {\n        setToken(null, null, null);\n        kc.onAuthLogout && kc.onAuthLogout();\n\n        if (kc.loginRequired) {\n          kc.login();\n        }\n      }\n    };\n\n    function getRealmUrl() {\n      if (typeof kc.authServerUrl !== 'undefined') {\n        if (kc.authServerUrl.charAt(kc.authServerUrl.length - 1) == '/') {\n          return kc.authServerUrl + 'realms/' + encodeURIComponent(kc.realm);\n        } else {\n          return kc.authServerUrl + '/realms/' + encodeURIComponent(kc.realm);\n        }\n      } else {\n        return undefined;\n      }\n    }\n\n    function getOrigin() {\n      if (!window.location.origin) {\n        return window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n      } else {\n        return window.location.origin;\n      }\n    }\n\n    function processCallback(oauth, promise) {\n      var code = oauth.code;\n      var error = oauth.error;\n      var prompt = oauth.prompt;\n      var timeLocal = new Date().getTime();\n\n      if (error) {\n        if (prompt != 'none') {\n          var errorData = {\n            error: error,\n            error_description: oauth.error_description\n          };\n          kc.onAuthError && kc.onAuthError(errorData);\n          promise && promise.setError(errorData);\n        } else {\n          promise && promise.setSuccess();\n        }\n\n        return;\n      } else if (kc.flow != 'standard' && (oauth.access_token || oauth.id_token)) {\n        authSuccess(oauth.access_token, null, oauth.id_token, true);\n      }\n\n      if (kc.flow != 'implicit' && code) {\n        var params = 'code=' + code + '&grant_type=authorization_code';\n        var url = kc.endpoints.token();\n        var req = new XMLHttpRequest();\n        req.open('POST', url, true);\n        req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\n        if (kc.clientId && kc.clientSecret) {\n          req.setRequestHeader('Authorization', 'Basic ' + btoa(kc.clientId + ':' + kc.clientSecret));\n        } else {\n          params += '&client_id=' + encodeURIComponent(kc.clientId);\n        }\n\n        params += '&redirect_uri=' + oauth.redirectUri;\n        req.withCredentials = true;\n\n        req.onreadystatechange = function () {\n          if (req.readyState == 4) {\n            if (req.status == 200) {\n              var tokenResponse = JSON.parse(req.responseText);\n              authSuccess(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], kc.flow === 'standard');\n            } else {\n              kc.onAuthError && kc.onAuthError();\n              promise && promise.setError();\n            }\n          }\n        };\n\n        req.send(params);\n      }\n\n      function authSuccess(accessToken, refreshToken, idToken, fulfillPromise) {\n        timeLocal = (timeLocal + new Date().getTime()) / 2;\n        setToken(accessToken, refreshToken, idToken, timeLocal);\n\n        if (useNonce && (kc.tokenParsed && kc.tokenParsed.nonce != oauth.storedNonce || kc.refreshTokenParsed && kc.refreshTokenParsed.nonce != oauth.storedNonce || kc.idTokenParsed && kc.idTokenParsed.nonce != oauth.storedNonce)) {\n          console.info('[KEYCLOAK] Invalid nonce, clearing token');\n          kc.clearToken();\n          promise && promise.setError();\n        } else {\n          if (fulfillPromise) {\n            kc.onAuthSuccess && kc.onAuthSuccess();\n            promise && promise.setSuccess();\n          }\n        }\n      }\n    }\n\n    function loadConfig(url) {\n      var promise = createPromise();\n      var configUrl;\n\n      if (!config) {\n        configUrl = 'keycloak.json';\n      } else if (typeof config === 'string') {\n        configUrl = config;\n      }\n\n      function setupOidcEndoints(oidcConfiguration) {\n        if (!oidcConfiguration) {\n          kc.endpoints = {\n            authorize: function () {\n              return getRealmUrl() + '/protocol/openid-connect/auth';\n            },\n            token: function () {\n              return getRealmUrl() + '/protocol/openid-connect/token';\n            },\n            logout: function () {\n              return getRealmUrl() + '/protocol/openid-connect/logout';\n            },\n            checkSessionIframe: function () {\n              var src = getRealmUrl() + '/protocol/openid-connect/login-status-iframe.html';\n\n              if (kc.iframeVersion) {\n                src = src + '?version=' + kc.iframeVersion;\n              }\n\n              return src;\n            },\n            register: function () {\n              return getRealmUrl() + '/protocol/openid-connect/registrations';\n            },\n            userinfo: function () {\n              return getRealmUrl() + '/protocol/openid-connect/userinfo';\n            }\n          };\n        } else {\n          kc.endpoints = {\n            authorize: function () {\n              return oidcConfiguration.authorization_endpoint;\n            },\n            token: function () {\n              return oidcConfiguration.token_endpoint;\n            },\n            logout: function () {\n              if (!oidcConfiguration.end_session_endpoint) {\n                throw \"Not supported by the OIDC server\";\n              }\n\n              return oidcConfiguration.end_session_endpoint;\n            },\n            checkSessionIframe: function () {\n              if (!oidcConfiguration.check_session_iframe) {\n                throw \"Not supported by the OIDC server\";\n              }\n\n              return oidcConfiguration.check_session_iframe;\n            },\n            register: function () {\n              throw 'Redirection to \"Register user\" page not supported in standard OIDC mode';\n            },\n            userinfo: function () {\n              if (!oidcConfiguration.userinfo_endpoint) {\n                throw \"Not supported by the OIDC server\";\n              }\n\n              return oidcConfiguration.userinfo_endpoint;\n            }\n          };\n        }\n      }\n\n      if (configUrl) {\n        var req = new XMLHttpRequest();\n        req.open('GET', configUrl, true);\n        req.setRequestHeader('Accept', 'application/json');\n\n        req.onreadystatechange = function () {\n          if (req.readyState == 4) {\n            if (req.status == 200 || fileLoaded(req)) {\n              var config = JSON.parse(req.responseText);\n              kc.authServerUrl = config['auth-server-url'];\n              kc.realm = config['realm'];\n              kc.clientId = config['resource'];\n              kc.clientSecret = (config['credentials'] || {})['secret'];\n              setupOidcEndoints(null);\n              promise.setSuccess();\n            } else {\n              promise.setError();\n            }\n          }\n        };\n\n        req.send();\n      } else {\n        if (!config.clientId) {\n          throw 'clientId missing';\n        }\n\n        kc.clientId = config.clientId;\n        kc.clientSecret = (config.credentials || {}).secret;\n        var oidcProvider = config['oidcProvider'];\n\n        if (!oidcProvider) {\n          if (!config['url']) {\n            var scripts = document.getElementsByTagName('script');\n\n            for (var i = 0; i < scripts.length; i++) {\n              if (scripts[i].src.match(/.*keycloak\\.js/)) {\n                config.url = scripts[i].src.substr(0, scripts[i].src.indexOf('/js/keycloak.js'));\n                break;\n              }\n            }\n          }\n\n          if (!config.realm) {\n            throw 'realm missing';\n          }\n\n          kc.authServerUrl = config.url;\n          kc.realm = config.realm;\n          setupOidcEndoints(null);\n          promise.setSuccess();\n        } else {\n          if (typeof oidcProvider === 'string') {\n            var oidcProviderConfigUrl;\n\n            if (oidcProvider.charAt(oidcProvider.length - 1) == '/') {\n              oidcProviderConfigUrl = oidcProvider + '.well-known/openid-configuration';\n            } else {\n              oidcProviderConfigUrl = oidcProvider + '/.well-known/openid-configuration';\n            }\n\n            var req = new XMLHttpRequest();\n            req.open('GET', oidcProviderConfigUrl, true);\n            req.setRequestHeader('Accept', 'application/json');\n\n            req.onreadystatechange = function () {\n              if (req.readyState == 4) {\n                if (req.status == 200 || fileLoaded(req)) {\n                  var oidcProviderConfig = JSON.parse(req.responseText);\n                  setupOidcEndoints(oidcProviderConfig);\n                  promise.setSuccess();\n                } else {\n                  promise.setError();\n                }\n              }\n            };\n\n            req.send();\n          } else {\n            setupOidcEndoints(oidcProvider);\n            promise.setSuccess();\n          }\n        }\n      }\n\n      return promise.promise;\n    }\n\n    function fileLoaded(xhr) {\n      return xhr.status == 0 && xhr.responseText && xhr.responseURL.startsWith('file:');\n    }\n\n    function setToken(token, refreshToken, idToken, timeLocal) {\n      if (kc.tokenTimeoutHandle) {\n        clearTimeout(kc.tokenTimeoutHandle);\n        kc.tokenTimeoutHandle = null;\n      }\n\n      if (refreshToken) {\n        kc.refreshToken = refreshToken;\n        kc.refreshTokenParsed = decodeToken(refreshToken);\n      } else {\n        delete kc.refreshToken;\n        delete kc.refreshTokenParsed;\n      }\n\n      if (idToken) {\n        kc.idToken = idToken;\n        kc.idTokenParsed = decodeToken(idToken);\n      } else {\n        delete kc.idToken;\n        delete kc.idTokenParsed;\n      }\n\n      if (token) {\n        kc.token = token;\n        kc.tokenParsed = decodeToken(token);\n        kc.sessionId = kc.tokenParsed.session_state;\n        kc.authenticated = true;\n        kc.subject = kc.tokenParsed.sub;\n        kc.realmAccess = kc.tokenParsed.realm_access;\n        kc.resourceAccess = kc.tokenParsed.resource_access;\n\n        if (timeLocal) {\n          kc.timeSkew = Math.floor(timeLocal / 1000) - kc.tokenParsed.iat;\n        }\n\n        if (kc.timeSkew != null) {\n          console.info('[KEYCLOAK] Estimated time difference between browser and server is ' + kc.timeSkew + ' seconds');\n\n          if (kc.onTokenExpired) {\n            var expiresIn = (kc.tokenParsed['exp'] - new Date().getTime() / 1000 + kc.timeSkew) * 1000;\n            console.info('[KEYCLOAK] Token expires in ' + Math.round(expiresIn / 1000) + ' s');\n\n            if (expiresIn <= 0) {\n              kc.onTokenExpired();\n            } else {\n              kc.tokenTimeoutHandle = setTimeout(kc.onTokenExpired, expiresIn);\n            }\n          }\n        }\n      } else {\n        delete kc.token;\n        delete kc.tokenParsed;\n        delete kc.subject;\n        delete kc.realmAccess;\n        delete kc.resourceAccess;\n        kc.authenticated = false;\n      }\n    }\n\n    function decodeToken(str) {\n      str = str.split('.')[1];\n      str = str.replace('/-/g', '+');\n      str = str.replace('/_/g', '/');\n\n      switch (str.length % 4) {\n        case 0:\n          break;\n\n        case 2:\n          str += '==';\n          break;\n\n        case 3:\n          str += '=';\n          break;\n\n        default:\n          throw 'Invalid token';\n      }\n\n      str = (str + '===').slice(0, str.length + str.length % 4);\n      str = str.replace(/-/g, '+').replace(/_/g, '/');\n      str = decodeURIComponent(escape(atob(str)));\n      str = JSON.parse(str);\n      return str;\n    }\n\n    function createUUID() {\n      var s = [];\n      var hexDigits = '0123456789abcdef';\n\n      for (var i = 0; i < 36; i++) {\n        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n      }\n\n      s[14] = '4';\n      s[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1);\n      s[8] = s[13] = s[18] = s[23] = '-';\n      var uuid = s.join('');\n      return uuid;\n    }\n\n    kc.callback_id = 0;\n\n    function createCallbackId() {\n      var id = '<id: ' + kc.callback_id++ + Math.random() + '>';\n      return id;\n    }\n\n    function parseCallback(url) {\n      var oauth = parseCallbackUrl(url);\n\n      if (!oauth) {\n        return;\n      }\n\n      var oauthState = callbackStorage.get(oauth.state);\n\n      if (oauthState) {\n        oauth.valid = true;\n        oauth.redirectUri = oauthState.redirectUri;\n        oauth.storedNonce = oauthState.nonce;\n        oauth.prompt = oauthState.prompt;\n      }\n\n      return oauth;\n    }\n\n    function parseCallbackUrl(url) {\n      var supportedParams;\n\n      switch (kc.flow) {\n        case 'standard':\n          supportedParams = ['code', 'state', 'session_state'];\n          break;\n\n        case 'implicit':\n          supportedParams = ['access_token', 'id_token', 'state', 'session_state'];\n          break;\n\n        case 'hybrid':\n          supportedParams = ['access_token', 'id_token', 'code', 'state', 'session_state'];\n          break;\n      }\n\n      supportedParams.push('error');\n      supportedParams.push('error_description');\n      supportedParams.push('error_uri');\n      var queryIndex = url.indexOf('?');\n      var fragmentIndex = url.indexOf('#');\n      var newUrl;\n      var parsed;\n\n      if (kc.responseMode === 'query' && queryIndex !== -1) {\n        newUrl = url.substring(0, queryIndex);\n        parsed = parseCallbackParams(url.substring(queryIndex + 1, fragmentIndex !== -1 ? fragmentIndex : url.length), supportedParams);\n\n        if (parsed.paramsString !== '') {\n          newUrl += '?' + parsed.paramsString;\n        }\n\n        if (fragmentIndex !== -1) {\n          newUrl += url.substring(fragmentIndex);\n        }\n      } else if (kc.responseMode === 'fragment' && fragmentIndex !== -1) {\n        newUrl = url.substring(0, fragmentIndex);\n        parsed = parseCallbackParams(url.substring(fragmentIndex + 1), supportedParams);\n\n        if (parsed.paramsString !== '') {\n          newUrl += '#' + parsed.paramsString;\n        }\n      }\n\n      if (parsed && parsed.oauthParams) {\n        if (kc.flow === 'standard' || kc.flow === 'hybrid') {\n          if ((parsed.oauthParams.code || parsed.oauthParams.error) && parsed.oauthParams.state) {\n            parsed.oauthParams.newUrl = newUrl;\n            return parsed.oauthParams;\n          }\n        } else if (kc.flow === 'implicit') {\n          if ((parsed.oauthParams.access_token || parsed.oauthParams.error) && parsed.oauthParams.state) {\n            parsed.oauthParams.newUrl = newUrl;\n            return parsed.oauthParams;\n          }\n        }\n      }\n    }\n\n    function parseCallbackParams(paramsString, supportedParams) {\n      var p = paramsString.split('&');\n      var result = {\n        paramsString: '',\n        oauthParams: {}\n      };\n\n      for (var i = 0; i < p.length; i++) {\n        var t = p[i].split('=');\n\n        if (supportedParams.indexOf(t[0]) !== -1) {\n          result.oauthParams[t[0]] = t[1];\n        } else {\n          if (result.paramsString !== '') {\n            result.paramsString += '&';\n          }\n\n          result.paramsString += p[i];\n        }\n      }\n\n      return result;\n    }\n\n    function createPromise() {\n      if (typeof Promise === \"function\") {\n        return createNativePromise();\n      } else {\n        return createLegacyPromise();\n      }\n    }\n\n    function createNativePromise() {\n      // Need to create a native Promise which also preserves the\n      // interface of the custom promise type previously used by the API\n      var p = {\n        setSuccess: function (result) {\n          p.success = true;\n          p.resolve(result);\n        },\n        setError: function (result) {\n          p.success = false;\n          p.reject(result);\n        }\n      };\n      p.promise = new Promise(function (resolve, reject) {\n        p.resolve = resolve;\n        p.reject = reject;\n      });\n\n      p.promise.success = function (callback) {\n        p.promise.then(callback);\n        return p.promise;\n      };\n\n      p.promise.error = function (callback) {\n        p.promise.catch(callback);\n        return p.promise;\n      };\n\n      return p;\n    }\n\n    function createLegacyPromise() {\n      var p = {\n        setSuccess: function (result) {\n          p.success = true;\n          p.result = result;\n\n          if (p.successCallback) {\n            p.successCallback(result);\n          }\n        },\n        setError: function (result) {\n          p.error = true;\n          p.result = result;\n\n          if (p.errorCallback) {\n            p.errorCallback(result);\n          }\n        },\n        promise: {\n          success: function (callback) {\n            if (p.success) {\n              callback(p.result);\n            } else if (!p.error) {\n              p.successCallback = callback;\n            }\n\n            return p.promise;\n          },\n          error: function (callback) {\n            if (p.error) {\n              callback(p.result);\n            } else if (!p.success) {\n              p.errorCallback = callback;\n            }\n\n            return p.promise;\n          }\n        }\n      };\n      return p;\n    }\n\n    function setupCheckLoginIframe() {\n      var promise = createPromise();\n\n      if (!loginIframe.enable) {\n        promise.setSuccess();\n        return promise.promise;\n      }\n\n      if (loginIframe.iframe) {\n        promise.setSuccess();\n        return promise.promise;\n      }\n\n      var iframe = document.createElement('iframe');\n      loginIframe.iframe = iframe;\n\n      iframe.onload = function () {\n        var authUrl = kc.endpoints.authorize();\n\n        if (authUrl.charAt(0) === '/') {\n          loginIframe.iframeOrigin = getOrigin();\n        } else {\n          loginIframe.iframeOrigin = authUrl.substring(0, authUrl.indexOf('/', 8));\n        }\n\n        promise.setSuccess();\n        setTimeout(check, loginIframe.interval * 1000);\n      };\n\n      var src = kc.endpoints.checkSessionIframe();\n      iframe.setAttribute('src', src);\n      iframe.setAttribute('title', 'keycloak-session-iframe');\n      iframe.style.display = 'none';\n      document.body.appendChild(iframe);\n\n      var messageCallback = function (event) {\n        if (event.origin !== loginIframe.iframeOrigin || loginIframe.iframe.contentWindow !== event.source) {\n          return;\n        }\n\n        if (!(event.data == 'unchanged' || event.data == 'changed' || event.data == 'error')) {\n          return;\n        }\n\n        if (event.data != 'unchanged') {\n          kc.clearToken();\n        }\n\n        var callbacks = loginIframe.callbackList.splice(0, loginIframe.callbackList.length);\n\n        for (var i = callbacks.length - 1; i >= 0; --i) {\n          var promise = callbacks[i];\n\n          if (event.data == 'unchanged') {\n            promise.setSuccess();\n          } else {\n            promise.setError();\n          }\n        }\n      };\n\n      window.addEventListener('message', messageCallback, false);\n\n      var check = function () {\n        checkLoginIframe();\n\n        if (kc.token) {\n          setTimeout(check, loginIframe.interval * 1000);\n        }\n      };\n\n      return promise.promise;\n    }\n\n    function checkLoginIframe() {\n      var promise = createPromise();\n\n      if (loginIframe.iframe && loginIframe.iframeOrigin) {\n        var msg = kc.clientId + ' ' + kc.sessionId;\n        loginIframe.callbackList.push(promise);\n        var origin = loginIframe.iframeOrigin;\n\n        if (loginIframe.callbackList.length == 1) {\n          loginIframe.iframe.contentWindow.postMessage(msg, origin);\n        }\n      } else {\n        promise.setSuccess();\n      }\n\n      return promise.promise;\n    }\n\n    function loadAdapter(type) {\n      if (!type || type == 'default') {\n        return {\n          login: function (options) {\n            window.location.href = kc.createLoginUrl(options);\n            return createPromise().promise;\n          },\n          logout: function (options) {\n            window.location.href = kc.createLogoutUrl(options);\n            return createPromise().promise;\n          },\n          register: function (options) {\n            window.location.href = kc.createRegisterUrl(options);\n            return createPromise().promise;\n          },\n          accountManagement: function () {\n            var accountUrl = kc.createAccountUrl();\n\n            if (typeof accountUrl !== 'undefined') {\n              window.location.href = accountUrl;\n            } else {\n              throw \"Not supported by the OIDC server\";\n            }\n\n            return createPromise().promise;\n          },\n          redirectUri: function (options, encodeHash) {\n            if (arguments.length == 1) {\n              encodeHash = true;\n            }\n\n            if (options && options.redirectUri) {\n              return options.redirectUri;\n            } else if (kc.redirectUri) {\n              return kc.redirectUri;\n            } else {\n              return location.href;\n            }\n          }\n        };\n      }\n\n      if (type == 'cordova') {\n        loginIframe.enable = false;\n\n        var cordovaOpenWindowWrapper = function (loginUrl, target, options) {\n          if (window.cordova && window.cordova.InAppBrowser) {\n            // Use inappbrowser for IOS and Android if available\n            return window.cordova.InAppBrowser.open(loginUrl, target, options);\n          } else {\n            return window.open(loginUrl, target, options);\n          }\n        };\n\n        return {\n          login: function (options) {\n            var promise = createPromise();\n            var o = 'location=no';\n\n            if (options && options.prompt == 'none') {\n              o += ',hidden=yes';\n            }\n\n            var loginUrl = kc.createLoginUrl(options);\n            var ref = cordovaOpenWindowWrapper(loginUrl, '_blank', o);\n            var completed = false;\n            ref.addEventListener('loadstart', function (event) {\n              if (event.url.indexOf('http://localhost') == 0) {\n                var callback = parseCallback(event.url);\n                processCallback(callback, promise);\n                ref.close();\n                completed = true;\n              }\n            });\n            ref.addEventListener('loaderror', function (event) {\n              if (!completed) {\n                if (event.url.indexOf('http://localhost') == 0) {\n                  var callback = parseCallback(event.url);\n                  processCallback(callback, promise);\n                  ref.close();\n                  completed = true;\n                } else {\n                  promise.setError();\n                  ref.close();\n                }\n              }\n            });\n            return promise.promise;\n          },\n          logout: function (options) {\n            var promise = createPromise();\n            var logoutUrl = kc.createLogoutUrl(options);\n            var ref = cordovaOpenWindowWrapper(logoutUrl, '_blank', 'location=no,hidden=yes');\n            var error;\n            ref.addEventListener('loadstart', function (event) {\n              if (event.url.indexOf('http://localhost') == 0) {\n                ref.close();\n              }\n            });\n            ref.addEventListener('loaderror', function (event) {\n              if (event.url.indexOf('http://localhost') == 0) {\n                ref.close();\n              } else {\n                error = true;\n                ref.close();\n              }\n            });\n            ref.addEventListener('exit', function (event) {\n              if (error) {\n                promise.setError();\n              } else {\n                kc.clearToken();\n                promise.setSuccess();\n              }\n            });\n            return promise.promise;\n          },\n          register: function () {\n            var registerUrl = kc.createRegisterUrl();\n            var ref = cordovaOpenWindowWrapper(registerUrl, '_blank', 'location=no');\n            ref.addEventListener('loadstart', function (event) {\n              if (event.url.indexOf('http://localhost') == 0) {\n                ref.close();\n              }\n            });\n          },\n          accountManagement: function () {\n            var accountUrl = kc.createAccountUrl();\n\n            if (typeof accountUrl !== 'undefined') {\n              var ref = cordovaOpenWindowWrapper(accountUrl, '_blank', 'location=no');\n              ref.addEventListener('loadstart', function (event) {\n                if (event.url.indexOf('http://localhost') == 0) {\n                  ref.close();\n                }\n              });\n            } else {\n              throw \"Not supported by the OIDC server\";\n            }\n          },\n          redirectUri: function (options) {\n            return 'http://localhost';\n          }\n        };\n      }\n\n      throw 'invalid adapter type: ' + type;\n    }\n\n    var LocalStorage = function () {\n      if (!(this instanceof LocalStorage)) {\n        return new LocalStorage();\n      }\n\n      localStorage.setItem('kc-test', 'test');\n      localStorage.removeItem('kc-test');\n      var cs = this;\n\n      function clearExpired() {\n        var time = new Date().getTime();\n\n        for (var i = 0; i < localStorage.length; i++) {\n          var key = localStorage.key(i);\n\n          if (key && key.indexOf('kc-callback-') == 0) {\n            var value = localStorage.getItem(key);\n\n            if (value) {\n              try {\n                var expires = JSON.parse(value).expires;\n\n                if (!expires || expires < time) {\n                  localStorage.removeItem(key);\n                }\n              } catch (err) {\n                localStorage.removeItem(key);\n              }\n            }\n          }\n        }\n      }\n\n      cs.get = function (state) {\n        if (!state) {\n          return;\n        }\n\n        var key = 'kc-callback-' + state;\n        var value = localStorage.getItem(key);\n\n        if (value) {\n          localStorage.removeItem(key);\n          value = JSON.parse(value);\n        }\n\n        clearExpired();\n        return value;\n      };\n\n      cs.add = function (state) {\n        clearExpired();\n        var key = 'kc-callback-' + state.state;\n        state.expires = new Date().getTime() + 60 * 60 * 1000;\n        localStorage.setItem(key, JSON.stringify(state));\n      };\n    };\n\n    var CookieStorage = function () {\n      if (!(this instanceof CookieStorage)) {\n        return new CookieStorage();\n      }\n\n      var cs = this;\n\n      cs.get = function (state) {\n        if (!state) {\n          return;\n        }\n\n        var value = getCookie('kc-callback-' + state);\n        setCookie('kc-callback-' + state, '', cookieExpiration(-100));\n\n        if (value) {\n          return JSON.parse(value);\n        }\n      };\n\n      cs.add = function (state) {\n        setCookie('kc-callback-' + state.state, JSON.stringify(state), cookieExpiration(60));\n      };\n\n      cs.removeItem = function (key) {\n        setCookie(key, '', cookieExpiration(-100));\n      };\n\n      var cookieExpiration = function (minutes) {\n        var exp = new Date();\n        exp.setTime(exp.getTime() + minutes * 60 * 1000);\n        return exp;\n      };\n\n      var getCookie = function (key) {\n        var name = key + '=';\n        var ca = document.cookie.split(';');\n\n        for (var i = 0; i < ca.length; i++) {\n          var c = ca[i];\n\n          while (c.charAt(0) == ' ') {\n            c = c.substring(1);\n          }\n\n          if (c.indexOf(name) == 0) {\n            return c.substring(name.length, c.length);\n          }\n        }\n\n        return '';\n      };\n\n      var setCookie = function (key, value, expirationDate) {\n        var cookie = key + '=' + value + '; ' + 'expires=' + expirationDate.toUTCString() + '; ';\n        document.cookie = cookie;\n      };\n    };\n\n    function createCallbackStorage() {\n      try {\n        return new LocalStorage();\n      } catch (err) {}\n\n      return new CookieStorage();\n    }\n  };\n\n  if (typeof module === \"object\" && module && typeof module.exports === \"object\") {\n    module.exports = Keycloak;\n  } else {\n    window.Keycloak = Keycloak;\n\n    if (typeof define === \"function\" && define.amd) {\n      define(\"keycloak\", [], function () {\n        return Keycloak;\n      });\n    }\n  }\n})(window);","map":{"version":3,"sources":["/Users/nikitavolynkin/Documents/map/newmap/SUPE-map-demo/node_modules/keycloak-js/dist/keycloak.js"],"names":["window","undefined","Keycloak","config","kc","adapter","refreshQueue","callbackStorage","loginIframe","enable","callbackList","interval","scripts","document","getElementsByTagName","i","length","src","indexOf","iframeVersion","substring","split","useNonce","init","initOptions","authenticated","createCallbackStorage","loadAdapter","Cordova","cordova","checkLoginIframe","checkLoginIframeInterval","onLoad","loginRequired","responseMode","flow","responseType","timeSkew","promise","createPromise","initPromise","success","onReady","setSuccess","error","errorData","setError","configPromise","loadConfig","doLogin","prompt","options","login","setupCheckLoginIframe","processInit","callback","parseCallback","location","href","history","replaceState","newUrl","valid","processCallback","e","token","refreshToken","setToken","idToken","onAuthSuccess","updateToken","onAuthError","createLoginUrl","state","createUUID","nonce","redirectUri","callbackState","encodeURIComponent","add","baseUrl","action","endpoints","register","authorize","scope","url","clientId","maxAge","loginHint","idpHint","locale","kcLocale","logout","createLogoutUrl","createRegisterUrl","createAccountUrl","realm","getRealmUrl","accountManagement","hasRealmRole","role","access","realmAccess","roles","hasResourceRole","resource","resourceAccess","loadUserProfile","req","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","profile","JSON","parse","responseText","send","loadUserInfo","userinfo","userInfo","isTokenExpired","minValidity","tokenParsed","console","info","expiresIn","Math","ceil","Date","getTime","exec","params","push","withCredentials","clientSecret","btoa","timeLocal","tokenResponse","onAuthRefreshSuccess","p","pop","warn","clearToken","onAuthRefreshError","iframePromise","onAuthLogout","authServerUrl","charAt","getOrigin","origin","protocol","hostname","port","oauth","code","error_description","access_token","id_token","authSuccess","accessToken","fulfillPromise","storedNonce","refreshTokenParsed","idTokenParsed","configUrl","setupOidcEndoints","oidcConfiguration","checkSessionIframe","authorization_endpoint","token_endpoint","end_session_endpoint","check_session_iframe","userinfo_endpoint","fileLoaded","credentials","secret","oidcProvider","match","substr","oidcProviderConfigUrl","oidcProviderConfig","xhr","responseURL","startsWith","tokenTimeoutHandle","clearTimeout","decodeToken","sessionId","session_state","subject","sub","realm_access","resource_access","floor","iat","onTokenExpired","round","setTimeout","str","replace","slice","decodeURIComponent","escape","atob","s","hexDigits","random","uuid","join","callback_id","createCallbackId","id","parseCallbackUrl","oauthState","get","supportedParams","queryIndex","fragmentIndex","parsed","parseCallbackParams","paramsString","oauthParams","result","t","Promise","createNativePromise","createLegacyPromise","resolve","reject","then","catch","successCallback","errorCallback","iframe","createElement","onload","authUrl","iframeOrigin","check","setAttribute","style","display","body","appendChild","messageCallback","event","contentWindow","source","data","callbacks","splice","addEventListener","msg","postMessage","type","accountUrl","encodeHash","arguments","cordovaOpenWindowWrapper","loginUrl","target","InAppBrowser","o","ref","completed","close","logoutUrl","registerUrl","LocalStorage","localStorage","setItem","removeItem","cs","clearExpired","time","key","value","getItem","expires","err","stringify","CookieStorage","getCookie","setCookie","cookieExpiration","minutes","exp","setTime","name","ca","cookie","c","expirationDate","toUTCString","module","exports","define","amd"],"mappings":"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","sourcesContent":["/*\n * Copyright 2016 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n(function( window, undefined ) {\n\n    var Keycloak = function (config) {\n        if (!(this instanceof Keycloak)) {\n            return new Keycloak(config);\n        }\n\n        var kc = this;\n        var adapter;\n        var refreshQueue = [];\n        var callbackStorage;\n\n        var loginIframe = {\n            enable: true,\n            callbackList: [],\n            interval: 5\n        };\n\n        var scripts = document.getElementsByTagName('script');\n        for (var i = 0; i < scripts.length; i++) {\n            if ((scripts[i].src.indexOf('keycloak.js') !== -1 || scripts[i].src.indexOf('keycloak.min.js') !== -1) && scripts[i].src.indexOf('version=') !== -1) {\n                kc.iframeVersion = scripts[i].src.substring(scripts[i].src.indexOf('version=') + 8).split('&')[0];\n            }\n        }\n\n        var useNonce = true;\n        \n        kc.init = function (initOptions) {\n            kc.authenticated = false;\n\n            callbackStorage = createCallbackStorage();\n\n            if (initOptions && initOptions.adapter === 'cordova') {\n                adapter = loadAdapter('cordova');\n            } else if (initOptions && initOptions.adapter === 'default') {\n                adapter = loadAdapter();\n            } else if (initOptions && typeof initOptions.adapter === \"object\") {\n                adapter = initOptions.adapter;\n            } else {\n                if (window.Cordova || window.cordova) {\n                    adapter = loadAdapter('cordova');\n                } else {\n                    adapter = loadAdapter();\n                }\n            }\n\n            if (initOptions) {\n                if (typeof initOptions.useNonce !== 'undefined') {\n                    useNonce = initOptions.useNonce;\n                }\n\n                if (typeof initOptions.checkLoginIframe !== 'undefined') {\n                    loginIframe.enable = initOptions.checkLoginIframe;\n                }\n\n                if (initOptions.checkLoginIframeInterval) {\n                    loginIframe.interval = initOptions.checkLoginIframeInterval;\n                }\n\n                if (initOptions.onLoad === 'login-required') {\n                    kc.loginRequired = true;\n                }\n\n                if (initOptions.responseMode) {\n                    if (initOptions.responseMode === 'query' || initOptions.responseMode === 'fragment') {\n                        kc.responseMode = initOptions.responseMode;\n                    } else {\n                        throw 'Invalid value for responseMode';\n                    }\n                }\n\n                if (initOptions.flow) {\n                    switch (initOptions.flow) {\n                        case 'standard':\n                            kc.responseType = 'code';\n                            break;\n                        case 'implicit':\n                            kc.responseType = 'id_token token';\n                            break;\n                        case 'hybrid':\n                            kc.responseType = 'code id_token token';\n                            break;\n                        default:\n                            throw 'Invalid value for flow';\n                    }\n                    kc.flow = initOptions.flow;\n                }\n\n                if (initOptions.timeSkew != null) {\n                    kc.timeSkew = initOptions.timeSkew;\n                }\n            }\n\n            if (!kc.responseMode) {\n                kc.responseMode = 'fragment';\n            }\n            if (!kc.responseType) {\n                kc.responseType = 'code';\n                kc.flow = 'standard';\n            }\n\n            var promise = createPromise();\n\n            var initPromise = createPromise();\n            initPromise.promise.success(function() {\n                kc.onReady && kc.onReady(kc.authenticated);\n                promise.setSuccess(kc.authenticated);\n            }).error(function(errorData) {\n                promise.setError(errorData);\n            });\n\n            var configPromise = loadConfig(config);\n\n            function onLoad() {\n                var doLogin = function(prompt) {\n                    if (!prompt) {\n                        options.prompt = 'none';\n                    }\n                    kc.login(options).success(function () {\n                        initPromise.setSuccess();\n                    }).error(function () {\n                        initPromise.setError();\n                    });\n                }\n\n                var options = {};\n                switch (initOptions.onLoad) {\n                    case 'check-sso':\n                        if (loginIframe.enable) {\n                            setupCheckLoginIframe().success(function() {\n                                checkLoginIframe().success(function () {\n                                    doLogin(false);\n                                }).error(function () {\n                                    initPromise.setSuccess();\n                                });\n                            });\n                        } else {\n                            doLogin(false);\n                        }\n                        break;\n                    case 'login-required':\n                        doLogin(true);\n                        break;\n                    default:\n                        throw 'Invalid value for onLoad';\n                }\n            }\n\n            function processInit() {\n                var callback = parseCallback(window.location.href);\n\n                if (callback) {\n                    window.history.replaceState({}, null, callback.newUrl);\n                }\n\n                if (callback && callback.valid) {\n                    return setupCheckLoginIframe().success(function() {\n                        processCallback(callback, initPromise);\n                    }).error(function (e) {\n                        initPromise.setError();\n                    });\n                } else if (initOptions) {\n                    if (initOptions.token && initOptions.refreshToken) {\n                        setToken(initOptions.token, initOptions.refreshToken, initOptions.idToken);\n\n                        if (loginIframe.enable) {\n                            setupCheckLoginIframe().success(function() {\n                                checkLoginIframe().success(function () {\n                                    kc.onAuthSuccess && kc.onAuthSuccess();\n                                    initPromise.setSuccess();\n                                }).error(function () {\n                                    setToken(null, null, null);\n                                    initPromise.setSuccess();\n                                });\n                            });\n                        } else {\n                            kc.updateToken(-1).success(function() {\n                                kc.onAuthSuccess && kc.onAuthSuccess();\n                                initPromise.setSuccess();\n                            }).error(function() {\n                                kc.onAuthError && kc.onAuthError();\n                                if (initOptions.onLoad) {\n                                    onLoad();\n                                } else {\n                                    initPromise.setError();\n                                }\n                            });\n                        }\n                    } else if (initOptions.onLoad) {\n                        onLoad();\n                    } else {\n                        initPromise.setSuccess();\n                    }\n                } else {\n                    initPromise.setSuccess();\n                }\n            }\n\n            configPromise.success(processInit);\n            configPromise.error(function() {\n                promise.setError();\n            });\n\n            return promise.promise;\n        }\n\n        kc.login = function (options) {\n            return adapter.login(options);\n        }\n\n        kc.createLoginUrl = function(options) {\n            var state = createUUID();\n            var nonce = createUUID();\n\n            var redirectUri = adapter.redirectUri(options);\n\n            var callbackState = {\n                state: state,\n                nonce: nonce,\n                redirectUri: encodeURIComponent(redirectUri)\n            }\n\n            if (options && options.prompt) {\n                callbackState.prompt = options.prompt;\n            }\n\n            callbackStorage.add(callbackState);\n\n            var baseUrl;\n            if (options && options.action == 'register') {\n                baseUrl = kc.endpoints.register();\n            } else {\n                baseUrl = kc.endpoints.authorize();\n            }\n\n            var scope = (options && options.scope) ? \"openid \" + options.scope : \"openid\";\n\n            var url = baseUrl\n                + '?client_id=' + encodeURIComponent(kc.clientId)\n                + '&redirect_uri=' + encodeURIComponent(redirectUri)\n                + '&state=' + encodeURIComponent(state)\n                + '&response_mode=' + encodeURIComponent(kc.responseMode)\n                + '&response_type=' + encodeURIComponent(kc.responseType)\n                + '&scope=' + encodeURIComponent(scope);\n                if (useNonce) {\n                    url = url + '&nonce=' + encodeURIComponent(nonce);\n                }\n\n            if (options && options.prompt) {\n                url += '&prompt=' + encodeURIComponent(options.prompt);\n            }\n\n            if (options && options.maxAge) {\n                url += '&max_age=' + encodeURIComponent(options.maxAge);\n            }\n\n            if (options && options.loginHint) {\n                url += '&login_hint=' + encodeURIComponent(options.loginHint);\n            }\n\n            if (options && options.idpHint) {\n                url += '&kc_idp_hint=' + encodeURIComponent(options.idpHint);\n            }\n\n            if (options && options.locale) {\n                url += '&ui_locales=' + encodeURIComponent(options.locale);\n            }\n            \n            if (options && options.kcLocale) {\n                url += '&kc_locale=' + encodeURIComponent(options.kcLocale);\n            }\n\n            return url;\n        }\n\n        kc.logout = function(options) {\n            return adapter.logout(options);\n        }\n\n        kc.createLogoutUrl = function(options) {\n            var url = kc.endpoints.logout()\n                + '?redirect_uri=' + encodeURIComponent(adapter.redirectUri(options, false));\n\n            return url;\n        }\n\n        kc.register = function (options) {\n            return adapter.register(options);\n        }\n\n        kc.createRegisterUrl = function(options) {\n            if (!options) {\n                options = {};\n            }\n            options.action = 'register';\n            return kc.createLoginUrl(options);\n        }\n\n        kc.createAccountUrl = function(options) {\n            var realm = getRealmUrl();\n            var url = undefined;\n            if (typeof realm !== 'undefined') {\n                url = realm\n                + '/account'\n                + '?referrer=' + encodeURIComponent(kc.clientId)\n                + '&referrer_uri=' + encodeURIComponent(adapter.redirectUri(options));\n            }\n            return url;\n        }\n\n        kc.accountManagement = function() {\n            return adapter.accountManagement();\n        }\n\n        kc.hasRealmRole = function (role) {\n            var access = kc.realmAccess;\n            return !!access && access.roles.indexOf(role) >= 0;\n        }\n\n        kc.hasResourceRole = function(role, resource) {\n            if (!kc.resourceAccess) {\n                return false;\n            }\n\n            var access = kc.resourceAccess[resource || kc.clientId];\n            return !!access && access.roles.indexOf(role) >= 0;\n        }\n\n        kc.loadUserProfile = function() {\n            var url = getRealmUrl() + '/account';\n            var req = new XMLHttpRequest();\n            req.open('GET', url, true);\n            req.setRequestHeader('Accept', 'application/json');\n            req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n\n            var promise = createPromise();\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        kc.profile = JSON.parse(req.responseText);\n                        promise.setSuccess(kc.profile);\n                    } else {\n                        promise.setError();\n                    }\n                }\n            }\n\n            req.send();\n\n            return promise.promise;\n        }\n\n        kc.loadUserInfo = function() {\n            var url = kc.endpoints.userinfo();\n            var req = new XMLHttpRequest();\n            req.open('GET', url, true);\n            req.setRequestHeader('Accept', 'application/json');\n            req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n\n            var promise = createPromise();\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        kc.userInfo = JSON.parse(req.responseText);\n                        promise.setSuccess(kc.userInfo);\n                    } else {\n                        promise.setError();\n                    }\n                }\n            }\n\n            req.send();\n\n            return promise.promise;\n        }\n\n        kc.isTokenExpired = function(minValidity) {\n            if (!kc.tokenParsed || (!kc.refreshToken && kc.flow != 'implicit' )) {\n                throw 'Not authenticated';\n            }\n\n            if (kc.timeSkew == null) {\n                console.info('[KEYCLOAK] Unable to determine if token is expired as timeskew is not set');\n                return true;\n            }\n\n            var expiresIn = kc.tokenParsed['exp'] - Math.ceil(new Date().getTime() / 1000) + kc.timeSkew;\n            if (minValidity) {\n                expiresIn -= minValidity;\n            }\n            return expiresIn < 0;\n        }\n\n        kc.updateToken = function(minValidity) {\n            var promise = createPromise();\n\n            if (!kc.refreshToken) {\n                promise.setError();\n                return promise.promise;\n            }\n\n            minValidity = minValidity || 5;\n\n            var exec = function() {\n                var refreshToken = false;\n                if (minValidity == -1) {\n                    refreshToken = true;\n                    console.info('[KEYCLOAK] Refreshing token: forced refresh');\n                } else if (!kc.tokenParsed || kc.isTokenExpired(minValidity)) {\n                    refreshToken = true;\n                    console.info('[KEYCLOAK] Refreshing token: token expired');\n                }\n\n                if (!refreshToken) {\n                    promise.setSuccess(false);\n                } else {\n                    var params = 'grant_type=refresh_token&' + 'refresh_token=' + kc.refreshToken;\n                    var url = kc.endpoints.token();\n\n                    refreshQueue.push(promise);\n\n                    if (refreshQueue.length == 1) {\n                        var req = new XMLHttpRequest();\n                        req.open('POST', url, true);\n                        req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n                        req.withCredentials = true;\n\n                        if (kc.clientId && kc.clientSecret) {\n                            req.setRequestHeader('Authorization', 'Basic ' + btoa(kc.clientId + ':' + kc.clientSecret));\n                        } else {\n                            params += '&client_id=' + encodeURIComponent(kc.clientId);\n                        }\n\n                        var timeLocal = new Date().getTime();\n\n                        req.onreadystatechange = function () {\n                            if (req.readyState == 4) {\n                                if (req.status == 200) {\n                                    console.info('[KEYCLOAK] Token refreshed');\n\n                                    timeLocal = (timeLocal + new Date().getTime()) / 2;\n\n                                    var tokenResponse = JSON.parse(req.responseText);\n\n                                    setToken(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], timeLocal);\n\n                                    kc.onAuthRefreshSuccess && kc.onAuthRefreshSuccess();\n                                    for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                                        p.setSuccess(true);\n                                    }\n                                } else {\n                                    console.warn('[KEYCLOAK] Failed to refresh token');\n\n                                    if (req.status == 400) {\n                                        kc.clearToken();\n                                    }\n\n                                    kc.onAuthRefreshError && kc.onAuthRefreshError();\n                                    for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                                        p.setError(true);\n                                    }\n                                }\n                            }\n                        };\n\n                        req.send(params);\n                    }\n                }\n            }\n\n            if (loginIframe.enable) {\n                var iframePromise = checkLoginIframe();\n                iframePromise.success(function() {\n                    exec();\n                }).error(function() {\n                    promise.setError();\n                });\n            } else {\n                exec();\n            }\n\n            return promise.promise;\n        }\n\n        kc.clearToken = function() {\n            if (kc.token) {\n                setToken(null, null, null);\n                kc.onAuthLogout && kc.onAuthLogout();\n                if (kc.loginRequired) {\n                    kc.login();\n                }\n            }\n        }\n\n        function getRealmUrl() {\n            if (typeof kc.authServerUrl !== 'undefined') {\n                if (kc.authServerUrl.charAt(kc.authServerUrl.length - 1) == '/') {\n                    return kc.authServerUrl + 'realms/' + encodeURIComponent(kc.realm);\n                } else {\n                    return kc.authServerUrl + '/realms/' + encodeURIComponent(kc.realm);\n                }\n            } else {\n            \treturn undefined;\n            }\n        }\n\n        function getOrigin() {\n            if (!window.location.origin) {\n                return window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');\n            } else {\n                return window.location.origin;\n            }\n        }\n\n        function processCallback(oauth, promise) {\n            var code = oauth.code;\n            var error = oauth.error;\n            var prompt = oauth.prompt;\n\n            var timeLocal = new Date().getTime();\n\n            if (error) {\n                if (prompt != 'none') {\n                    var errorData = { error: error, error_description: oauth.error_description };\n                    kc.onAuthError && kc.onAuthError(errorData);\n                    promise && promise.setError(errorData);\n                } else {\n                    promise && promise.setSuccess();\n                }\n                return;\n            } else if ((kc.flow != 'standard') && (oauth.access_token || oauth.id_token)) {\n                authSuccess(oauth.access_token, null, oauth.id_token, true);\n            }\n\n            if ((kc.flow != 'implicit') && code) {\n                var params = 'code=' + code + '&grant_type=authorization_code';\n                var url = kc.endpoints.token();\n\n                var req = new XMLHttpRequest();\n                req.open('POST', url, true);\n                req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\n                if (kc.clientId && kc.clientSecret) {\n                    req.setRequestHeader('Authorization', 'Basic ' + btoa(kc.clientId + ':' + kc.clientSecret));\n                } else {\n                    params += '&client_id=' + encodeURIComponent(kc.clientId);\n                }\n\n                params += '&redirect_uri=' + oauth.redirectUri;\n\n                req.withCredentials = true;\n\n                req.onreadystatechange = function() {\n                    if (req.readyState == 4) {\n                        if (req.status == 200) {\n\n                            var tokenResponse = JSON.parse(req.responseText);\n                            authSuccess(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], kc.flow === 'standard');\n                        } else {\n                            kc.onAuthError && kc.onAuthError();\n                            promise && promise.setError();\n                        }\n                    }\n                };\n\n                req.send(params);\n            }\n\n            function authSuccess(accessToken, refreshToken, idToken, fulfillPromise) {\n                timeLocal = (timeLocal + new Date().getTime()) / 2;\n\n                setToken(accessToken, refreshToken, idToken, timeLocal);\n\n                if (useNonce && ((kc.tokenParsed && kc.tokenParsed.nonce != oauth.storedNonce) ||\n                    (kc.refreshTokenParsed && kc.refreshTokenParsed.nonce != oauth.storedNonce) ||\n                    (kc.idTokenParsed && kc.idTokenParsed.nonce != oauth.storedNonce))) {\n\n                    console.info('[KEYCLOAK] Invalid nonce, clearing token');\n                    kc.clearToken();\n                    promise && promise.setError();\n                } else {\n                    if (fulfillPromise) {\n                        kc.onAuthSuccess && kc.onAuthSuccess();\n                        promise && promise.setSuccess();\n                    }\n                }\n            }\n\n        }\n\n        function loadConfig(url) {\n            var promise = createPromise();\n            var configUrl;\n\n            if (!config) {\n                configUrl = 'keycloak.json';\n            } else if (typeof config === 'string') {\n                configUrl = config;\n            }\n\n            function setupOidcEndoints(oidcConfiguration) {\n                if (! oidcConfiguration) {\n                    kc.endpoints = {\n                        authorize: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/auth';\n                        },\n                        token: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/token';\n                        },\n                        logout: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/logout';\n                        },\n                        checkSessionIframe: function() {\n                            var src = getRealmUrl() + '/protocol/openid-connect/login-status-iframe.html';\n                            if (kc.iframeVersion) {\n                              src = src + '?version=' + kc.iframeVersion;\n                            }\n                            return src;\n                        },\n                        register: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/registrations';\n                        },\n                        userinfo: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/userinfo';\n                        }\n                    };\n                } else {\n                    kc.endpoints = {\n                        authorize: function() {\n                            return oidcConfiguration.authorization_endpoint;\n                        },\n                        token: function() {\n                            return oidcConfiguration.token_endpoint;\n                        },\n                        logout: function() {\n                            if (!oidcConfiguration.end_session_endpoint) {\n                                throw \"Not supported by the OIDC server\";\n                            }\n                            return oidcConfiguration.end_session_endpoint;\n                        },\n                        checkSessionIframe: function() {\n                            if (!oidcConfiguration.check_session_iframe) {\n                                throw \"Not supported by the OIDC server\";\n                            }\n                            return oidcConfiguration.check_session_iframe;\n                        },\n                        register: function() {\n                            throw 'Redirection to \"Register user\" page not supported in standard OIDC mode';\n                        },\n                        userinfo: function() {\n                            if (!oidcConfiguration.userinfo_endpoint) {\n                                throw \"Not supported by the OIDC server\";\n                            }\n                            return oidcConfiguration.userinfo_endpoint;\n                        }\n                    }\n                }\n            }\n\n            if (configUrl) {\n                var req = new XMLHttpRequest();\n                req.open('GET', configUrl, true);\n                req.setRequestHeader('Accept', 'application/json');\n\n                req.onreadystatechange = function () {\n                    if (req.readyState == 4) {\n                        if (req.status == 200 || fileLoaded(req)) {\n                            var config = JSON.parse(req.responseText);\n\n                            kc.authServerUrl = config['auth-server-url'];\n                            kc.realm = config['realm'];\n                            kc.clientId = config['resource'];\n                            kc.clientSecret = (config['credentials'] || {})['secret'];\n                            setupOidcEndoints(null);\n                            promise.setSuccess();\n                        } else {\n                            promise.setError();\n                        }\n                    }\n                };\n\n                req.send();\n            } else {\n                if (!config.clientId) {\n                    throw 'clientId missing';\n                }\n\n                kc.clientId = config.clientId;\n                kc.clientSecret = (config.credentials || {}).secret;\n\n                var oidcProvider = config['oidcProvider'];\n                if (!oidcProvider) {\n                    if (!config['url']) {\n                        var scripts = document.getElementsByTagName('script');\n                        for (var i = 0; i < scripts.length; i++) {\n                            if (scripts[i].src.match(/.*keycloak\\.js/)) {\n                                config.url = scripts[i].src.substr(0, scripts[i].src.indexOf('/js/keycloak.js'));\n                                break;\n                            }\n                        }\n                    }\n                    if (!config.realm) {\n                        throw 'realm missing';\n                    }\n\n                    kc.authServerUrl = config.url;\n                    kc.realm = config.realm;\n                    setupOidcEndoints(null);\n                    promise.setSuccess();\n                } else {\n                    if (typeof oidcProvider === 'string') {\n                        var oidcProviderConfigUrl;\n                        if (oidcProvider.charAt(oidcProvider.length - 1) == '/') {\n                            oidcProviderConfigUrl = oidcProvider + '.well-known/openid-configuration';\n                        } else {\n                            oidcProviderConfigUrl = oidcProvider + '/.well-known/openid-configuration';\n                        }\n                        var req = new XMLHttpRequest();\n                        req.open('GET', oidcProviderConfigUrl, true);\n                        req.setRequestHeader('Accept', 'application/json');\n\n                        req.onreadystatechange = function () {\n                            if (req.readyState == 4) {\n                                if (req.status == 200 || fileLoaded(req)) {\n                                    var oidcProviderConfig = JSON.parse(req.responseText);\n                                    setupOidcEndoints(oidcProviderConfig);\n                                    promise.setSuccess();\n                                } else {\n                                    promise.setError();\n                                }\n                            }\n                        };\n\n                        req.send();\n                    } else {\n                        setupOidcEndoints(oidcProvider);\n                        promise.setSuccess();\n                    }\n                }\n            }\n\n            return promise.promise;\n        }\n\n        function fileLoaded(xhr) {\n            return xhr.status == 0 && xhr.responseText && xhr.responseURL.startsWith('file:');\n        }\n\n        function setToken(token, refreshToken, idToken, timeLocal) {\n            if (kc.tokenTimeoutHandle) {\n                clearTimeout(kc.tokenTimeoutHandle);\n                kc.tokenTimeoutHandle = null;\n            }\n\n            if (refreshToken) {\n                kc.refreshToken = refreshToken;\n                kc.refreshTokenParsed = decodeToken(refreshToken);\n            } else {\n                delete kc.refreshToken;\n                delete kc.refreshTokenParsed;\n            }\n\n            if (idToken) {\n                kc.idToken = idToken;\n                kc.idTokenParsed = decodeToken(idToken);\n            } else {\n                delete kc.idToken;\n                delete kc.idTokenParsed;\n            }\n\n            if (token) {\n                kc.token = token;\n                kc.tokenParsed = decodeToken(token);\n                kc.sessionId = kc.tokenParsed.session_state;\n                kc.authenticated = true;\n                kc.subject = kc.tokenParsed.sub;\n                kc.realmAccess = kc.tokenParsed.realm_access;\n                kc.resourceAccess = kc.tokenParsed.resource_access;\n\n                if (timeLocal) {\n                    kc.timeSkew = Math.floor(timeLocal / 1000) - kc.tokenParsed.iat;\n                }\n\n                if (kc.timeSkew != null) {\n                    console.info('[KEYCLOAK] Estimated time difference between browser and server is ' + kc.timeSkew + ' seconds');\n\n                    if (kc.onTokenExpired) {\n                        var expiresIn = (kc.tokenParsed['exp'] - (new Date().getTime() / 1000) + kc.timeSkew) * 1000;\n                        console.info('[KEYCLOAK] Token expires in ' + Math.round(expiresIn / 1000) + ' s');\n                        if (expiresIn <= 0) {\n                            kc.onTokenExpired();\n                        } else {\n                            kc.tokenTimeoutHandle = setTimeout(kc.onTokenExpired, expiresIn);\n                        }\n                    }\n                }\n            } else {\n                delete kc.token;\n                delete kc.tokenParsed;\n                delete kc.subject;\n                delete kc.realmAccess;\n                delete kc.resourceAccess;\n\n                kc.authenticated = false;\n            }\n        }\n\n        function decodeToken(str) {\n            str = str.split('.')[1];\n\n            str = str.replace('/-/g', '+');\n            str = str.replace('/_/g', '/');\n            switch (str.length % 4)\n            {\n                case 0:\n                    break;\n                case 2:\n                    str += '==';\n                    break;\n                case 3:\n                    str += '=';\n                    break;\n                default:\n                    throw 'Invalid token';\n            }\n\n            str = (str + '===').slice(0, str.length + (str.length % 4));\n            str = str.replace(/-/g, '+').replace(/_/g, '/');\n\n            str = decodeURIComponent(escape(atob(str)));\n\n            str = JSON.parse(str);\n            return str;\n        }\n\n        function createUUID() {\n            var s = [];\n            var hexDigits = '0123456789abcdef';\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = '4';\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\n            s[8] = s[13] = s[18] = s[23] = '-';\n            var uuid = s.join('');\n            return uuid;\n        }\n\n        kc.callback_id = 0;\n\n        function createCallbackId() {\n            var id = '<id: ' + (kc.callback_id++) + (Math.random()) + '>';\n            return id;\n\n        }\n\n        function parseCallback(url) {\n            var oauth = parseCallbackUrl(url);\n            if (!oauth) {\n                return;\n            }\n\n            var oauthState = callbackStorage.get(oauth.state);\n\n            if (oauthState) {\n                oauth.valid = true;\n                oauth.redirectUri = oauthState.redirectUri;\n                oauth.storedNonce = oauthState.nonce;\n                oauth.prompt = oauthState.prompt;\n            }\n\n            return oauth;\n        }\n\n        function parseCallbackUrl(url) {\n            var supportedParams;\n            switch (kc.flow) {\n                case 'standard':\n                    supportedParams = ['code', 'state', 'session_state'];\n                    break;\n                case 'implicit':\n                    supportedParams = ['access_token', 'id_token', 'state', 'session_state'];\n                    break;\n                case 'hybrid':\n                    supportedParams = ['access_token', 'id_token', 'code', 'state', 'session_state'];\n                    break;\n            }\n\n            supportedParams.push('error');\n            supportedParams.push('error_description');\n            supportedParams.push('error_uri');\n\n            var queryIndex = url.indexOf('?');\n            var fragmentIndex = url.indexOf('#');\n\n            var newUrl;\n            var parsed;\n\n            if (kc.responseMode === 'query' && queryIndex !== -1) {\n                newUrl = url.substring(0, queryIndex);\n                parsed = parseCallbackParams(url.substring(queryIndex + 1, fragmentIndex !== -1 ? fragmentIndex : url.length), supportedParams);\n                if (parsed.paramsString !== '') {\n                    newUrl += '?' + parsed.paramsString;\n                }\n                if (fragmentIndex !== -1) {\n                    newUrl += url.substring(fragmentIndex);\n                }\n            } else if (kc.responseMode === 'fragment' && fragmentIndex !== -1) {\n                newUrl = url.substring(0, fragmentIndex);\n                parsed = parseCallbackParams(url.substring(fragmentIndex + 1), supportedParams);\n                if (parsed.paramsString !== '') {\n                    newUrl += '#' + parsed.paramsString;\n                }\n            }\n\n            if (parsed && parsed.oauthParams) {\n                if (kc.flow === 'standard' || kc.flow === 'hybrid') {\n                    if ((parsed.oauthParams.code || parsed.oauthParams.error) && parsed.oauthParams.state) {\n                        parsed.oauthParams.newUrl = newUrl;\n                        return parsed.oauthParams;\n                    }\n                } else if (kc.flow === 'implicit') {\n                    if ((parsed.oauthParams.access_token || parsed.oauthParams.error) && parsed.oauthParams.state) {\n                        parsed.oauthParams.newUrl = newUrl;\n                        return parsed.oauthParams;\n                    }\n                }\n            }\n        }\n\n        function parseCallbackParams(paramsString, supportedParams) {\n            var p = paramsString.split('&');\n            var result = {\n                paramsString: '',\n                oauthParams: {}\n            }\n            for (var i = 0; i < p.length; i++) {\n                var t = p[i].split('=');\n                if (supportedParams.indexOf(t[0]) !== -1) {\n                    result.oauthParams[t[0]] = t[1];\n                } else {\n                    if (result.paramsString !== '') {\n                        result.paramsString += '&';\n                    }\n                    result.paramsString += p[i];\n                }\n            }\n            return result;\n        }\n\n        function createPromise() {\n            if (typeof Promise === \"function\") {\n                return createNativePromise();\n            } else {\n                return createLegacyPromise();\n            }\n        }\n\n        function createNativePromise() {\n            // Need to create a native Promise which also preserves the\n            // interface of the custom promise type previously used by the API\n            var p = {\n                setSuccess: function(result) {\n                    p.success = true;\n                    p.resolve(result);\n                },\n\n                setError: function(result) {\n                    p.success = false;\n                    p.reject(result);\n                }\n            };\n            p.promise = new Promise(function(resolve, reject) {\n                p.resolve = resolve;\n                p.reject = reject;\n            });\n            p.promise.success = function(callback) {\n                p.promise.then(callback);\n                return p.promise;\n            }\n            p.promise.error = function(callback) {\n                p.promise.catch(callback);\n                return p.promise;\n            }\n            return p;\n        }\n\n        function createLegacyPromise() {\n            var p = {\n                setSuccess: function(result) {\n                    p.success = true;\n                    p.result = result;\n                    if (p.successCallback) {\n                        p.successCallback(result);\n                    }\n                },\n\n                setError: function(result) {\n                    p.error = true;\n                    p.result = result;\n                    if (p.errorCallback) {\n                        p.errorCallback(result);\n                    }\n                },\n\n                promise: {\n                    success: function(callback) {\n                        if (p.success) {\n                            callback(p.result);\n                        } else if (!p.error) {\n                            p.successCallback = callback;\n                        }\n                        return p.promise;\n                    },\n                    error: function(callback) {\n                        if (p.error) {\n                            callback(p.result);\n                        } else if (!p.success) {\n                            p.errorCallback = callback;\n                        }\n                        return p.promise;\n                    }\n                }\n            }\n            return p;\n        }\n\n        function setupCheckLoginIframe() {\n            var promise = createPromise();\n\n            if (!loginIframe.enable) {\n                promise.setSuccess();\n                return promise.promise;\n            }\n\n            if (loginIframe.iframe) {\n                promise.setSuccess();\n                return promise.promise;\n            }\n\n            var iframe = document.createElement('iframe');\n            loginIframe.iframe = iframe;\n\n            iframe.onload = function() {\n                var authUrl = kc.endpoints.authorize();\n                if (authUrl.charAt(0) === '/') {\n                    loginIframe.iframeOrigin = getOrigin();\n                } else {\n                    loginIframe.iframeOrigin = authUrl.substring(0, authUrl.indexOf('/', 8));\n                }\n                promise.setSuccess();\n\n                setTimeout(check, loginIframe.interval * 1000);\n            }\n\n            var src = kc.endpoints.checkSessionIframe();\n            iframe.setAttribute('src', src );\n            iframe.setAttribute('title', 'keycloak-session-iframe' );\n            iframe.style.display = 'none';\n            document.body.appendChild(iframe);\n\n            var messageCallback = function(event) {\n                if ((event.origin !== loginIframe.iframeOrigin) || (loginIframe.iframe.contentWindow !== event.source)) {\n                    return;\n                }\n\n                if (!(event.data == 'unchanged' || event.data == 'changed' || event.data == 'error')) {\n                    return;\n                }\n\n\n                if (event.data != 'unchanged') {\n                    kc.clearToken();\n                }\n\n                var callbacks = loginIframe.callbackList.splice(0, loginIframe.callbackList.length);\n\n                for (var i = callbacks.length - 1; i >= 0; --i) {\n                    var promise = callbacks[i];\n                    if (event.data == 'unchanged') {\n                        promise.setSuccess();\n                    } else {\n                        promise.setError();\n                    }\n                }\n            };\n\n            window.addEventListener('message', messageCallback, false);\n\n            var check = function() {\n                checkLoginIframe();\n                if (kc.token) {\n                    setTimeout(check, loginIframe.interval * 1000);\n                }\n            };\n\n            return promise.promise;\n        }\n\n        function checkLoginIframe() {\n            var promise = createPromise();\n\n            if (loginIframe.iframe && loginIframe.iframeOrigin ) {\n                var msg = kc.clientId + ' ' + kc.sessionId;\n                loginIframe.callbackList.push(promise);\n                var origin = loginIframe.iframeOrigin;\n                if (loginIframe.callbackList.length == 1) {\n                    loginIframe.iframe.contentWindow.postMessage(msg, origin);\n                }\n            } else {\n                promise.setSuccess();\n            }\n\n            return promise.promise;\n        }\n\n        function loadAdapter(type) {\n            if (!type || type == 'default') {\n                return {\n                    login: function(options) {\n                        window.location.href = kc.createLoginUrl(options);\n                        return createPromise().promise;\n                    },\n\n                    logout: function(options) {\n                        window.location.href = kc.createLogoutUrl(options);\n                        return createPromise().promise;\n                    },\n\n                    register: function(options) {\n                        window.location.href = kc.createRegisterUrl(options);\n                        return createPromise().promise;\n                    },\n\n                    accountManagement : function() {\n                        var accountUrl = kc.createAccountUrl();\n                        if (typeof accountUrl !== 'undefined') {\n                            window.location.href = accountUrl;\n                        } else {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                        return createPromise().promise;\n                    },\n\n                    redirectUri: function(options, encodeHash) {\n                        if (arguments.length == 1) {\n                            encodeHash = true;\n                        }\n\n                        if (options && options.redirectUri) {\n                            return options.redirectUri;\n                        } else if (kc.redirectUri) {\n                            return kc.redirectUri;\n                        } else {\n                            return location.href;\n                        }\n                    }\n                };\n            }\n\n            if (type == 'cordova') {\n                loginIframe.enable = false;\n                var cordovaOpenWindowWrapper = function(loginUrl, target, options) {\n                    if (window.cordova && window.cordova.InAppBrowser) {\n                        // Use inappbrowser for IOS and Android if available\n                        return window.cordova.InAppBrowser.open(loginUrl, target, options);\n                    } else {\n                        return window.open(loginUrl, target, options);\n                    }\n                };\n                return {\n                    login: function(options) {\n                        var promise = createPromise();\n\n                        var o = 'location=no';\n                        if (options && options.prompt == 'none') {\n                            o += ',hidden=yes';\n                        }\n\n                        var loginUrl = kc.createLoginUrl(options);\n                        var ref = cordovaOpenWindowWrapper(loginUrl, '_blank', o);\n                        var completed = false;\n\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                var callback = parseCallback(event.url);\n                                processCallback(callback, promise);\n                                ref.close();\n                                completed = true;\n                            }\n                        });\n\n                        ref.addEventListener('loaderror', function(event) {\n                            if (!completed) {\n                                if (event.url.indexOf('http://localhost') == 0) {\n                                    var callback = parseCallback(event.url);\n                                    processCallback(callback, promise);\n                                    ref.close();\n                                    completed = true;\n                                } else {\n                                    promise.setError();\n                                    ref.close();\n                                }\n                            }\n                        });\n\n                        return promise.promise;\n                    },\n\n                    logout: function(options) {\n                        var promise = createPromise();\n\n                        var logoutUrl = kc.createLogoutUrl(options);\n                        var ref = cordovaOpenWindowWrapper(logoutUrl, '_blank', 'location=no,hidden=yes');\n\n                        var error;\n\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                ref.close();\n                            }\n                        });\n\n                        ref.addEventListener('loaderror', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                ref.close();\n                            } else {\n                                error = true;\n                                ref.close();\n                            }\n                        });\n\n                        ref.addEventListener('exit', function(event) {\n                            if (error) {\n                                promise.setError();\n                            } else {\n                                kc.clearToken();\n                                promise.setSuccess();\n                            }\n                        });\n\n                        return promise.promise;\n                    },\n\n                    register : function() {\n                        var registerUrl = kc.createRegisterUrl();\n                        var ref = cordovaOpenWindowWrapper(registerUrl, '_blank', 'location=no');\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                ref.close();\n                            }\n                        });\n                    },\n\n                    accountManagement : function() {\n                        var accountUrl = kc.createAccountUrl();\n                        if (typeof accountUrl !== 'undefined') {\n                            var ref = cordovaOpenWindowWrapper(accountUrl, '_blank', 'location=no');\n                            ref.addEventListener('loadstart', function(event) {\n                                if (event.url.indexOf('http://localhost') == 0) {\n                                    ref.close();\n                                }\n                            });\n                        } else {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                    },\n\n                    redirectUri: function(options) {\n                        return 'http://localhost';\n                    }\n                }\n            }\n\n            throw 'invalid adapter type: ' + type;\n        }\n\n        var LocalStorage = function() {\n            if (!(this instanceof LocalStorage)) {\n                return new LocalStorage();\n            }\n\n            localStorage.setItem('kc-test', 'test');\n            localStorage.removeItem('kc-test');\n\n            var cs = this;\n\n            function clearExpired() {\n                var time = new Date().getTime();\n                for (var i = 0; i < localStorage.length; i++)  {\n                    var key = localStorage.key(i);\n                    if (key && key.indexOf('kc-callback-') == 0) {\n                        var value = localStorage.getItem(key);\n                        if (value) {\n                            try {\n                                var expires = JSON.parse(value).expires;\n                                if (!expires || expires < time) {\n                                    localStorage.removeItem(key);\n                                }\n                            } catch (err) {\n                                localStorage.removeItem(key);\n                            }\n                        }\n                    }\n                }\n            }\n\n            cs.get = function(state) {\n                if (!state) {\n                    return;\n                }\n\n                var key = 'kc-callback-' + state;\n                var value = localStorage.getItem(key);\n                if (value) {\n                    localStorage.removeItem(key);\n                    value = JSON.parse(value);\n                }\n\n                clearExpired();\n                return value;\n            };\n\n            cs.add = function(state) {\n                clearExpired();\n\n                var key = 'kc-callback-' + state.state;\n                state.expires = new Date().getTime() + (60 * 60 * 1000);\n                localStorage.setItem(key, JSON.stringify(state));\n            };\n        };\n\n        var CookieStorage = function() {\n            if (!(this instanceof CookieStorage)) {\n                return new CookieStorage();\n            }\n\n            var cs = this;\n\n            cs.get = function(state) {\n                if (!state) {\n                    return;\n                }\n\n                var value = getCookie('kc-callback-' + state);\n                setCookie('kc-callback-' + state, '', cookieExpiration(-100));\n                if (value) {\n                    return JSON.parse(value);\n                }\n            };\n\n            cs.add = function(state) {\n                setCookie('kc-callback-' + state.state, JSON.stringify(state), cookieExpiration(60));\n            };\n\n            cs.removeItem = function(key) {\n                setCookie(key, '', cookieExpiration(-100));\n            };\n\n            var cookieExpiration = function (minutes) {\n                var exp = new Date();\n                exp.setTime(exp.getTime() + (minutes*60*1000));\n                return exp;\n            };\n\n            var getCookie = function (key) {\n                var name = key + '=';\n                var ca = document.cookie.split(';');\n                for (var i = 0; i < ca.length; i++) {\n                    var c = ca[i];\n                    while (c.charAt(0) == ' ') {\n                        c = c.substring(1);\n                    }\n                    if (c.indexOf(name) == 0) {\n                        return c.substring(name.length, c.length);\n                    }\n                }\n                return '';\n            };\n\n            var setCookie = function (key, value, expirationDate) {\n                var cookie = key + '=' + value + '; '\n                    + 'expires=' + expirationDate.toUTCString() + '; ';\n                document.cookie = cookie;\n            }\n        };\n\n        function createCallbackStorage() {\n            try {\n                return new LocalStorage();\n            } catch (err) {\n            }\n\n            return new CookieStorage();\n        }\n    }\n\n    if ( typeof module === \"object\" && module && typeof module.exports === \"object\" ) {\n        module.exports = Keycloak;\n    } else {\n        window.Keycloak = Keycloak;\n\n        if ( typeof define === \"function\" && define.amd ) {\n            define( \"keycloak\", [], function () { return Keycloak; } );\n        }\n    }\n})( window );\n"]},"metadata":{},"sourceType":"script"}